<script type='text/javascript'>

  var map = L.mapbox.map('map-canvas', 'examples.map-9ijuk24y')
      .setView([0, 0], 12);

  var markers = new L.featureGroup();

  var geoJson = []

  <% restaurants.each do |restaurant| %>
    var details = {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [<%= restaurant.longitude %>,
                      <%= restaurant.latitude %>]
      },
      properties: {
        title: '<%= restaurant.name %>',
        description: '<%= restaurant.address %>',
        'marker-size': 'medium',
        'marker-color': '<%= restaurant.completed ? '#009f5c' : '#ff8079' %>',
        'marker-symbol': '<%= restaurant.place_type %>'
      }
    }
    geoJson.push(details)
    markers.addLayer(L.mapbox.markerLayer(details))

  <% end %>
  map.markerLayer.setGeoJSON(geoJson)
  map.fitBounds(markers.getBounds())

  BellyGuide.map = map
  BellyGuide.markers = markers
  BellyGuide.center = map.getCenter()
  BellyGuide.zoom = map.getZoom()
  BellyGuide.geoJson = geoJson

  var bakery = document.getElementById('filter-bakery');
  var bar = document.getElementById('filter-bar');
  var alcohol_shop = document.getElementById('filter-alcohol-shop');
  var cafe = document.getElementById('filter-cafe');
  var fast_food = document.getElementById('filter-fast-food');
  var grocery = document.getElementById('filter-grocery');
  var restaurant = document.getElementById('filter-restaurant');
  var slaughterhouse = document.getElementById('filter-slaughterhouse');

  var items = [bakery, bar, alcohol_shop, cafe,
               fast_food, grocery, restaurant, slaughterhouse]
  var symbols = ['bakery', 'bar', 'alcohol-shop', 'cafe',
              'fast-food', 'grocery', 'restaurant', 'slaughterhouse']

  var all = document.getElementById('filter-all');


  _(items).each(function (item, index) {
    item.onclick = function(e) {
      all.className = '';
      _(items).each(function(item){ item.className = ''; })
      this.className = 'active';
      map.markerLayer.setFilter(function(f) {
        return f.properties['marker-symbol'] === symbols[index]
      });
      return false
    };
  })

  all.onclick = function() {
      _(items).each(function(item){ item.className = ''; })
      this.className = 'active';
      map.markerLayer.setFilter(function(f) {
          return true;
      });
      return false;
  };

</script>
