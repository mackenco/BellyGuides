<script type='text/javascript'>

  var map = L.mapbox.map('map-canvas', 'examples.map-9ijuk24y')
      .setView([0, 0], 12);

  var markers = new L.featureGroup();

  var geoJson = []

  <% restaurants.each do |restaurant| %>
    var details = {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [<%= restaurant.longitude %>,
                      <%= restaurant.latitude %>]
      },
      properties: {
        title: '<%= restaurant.name %>',
        description: '<%= restaurant.address %>',
        'marker-size': 'medium',
        'marker-color': '<%= restaurant.completed ? '#009f5c' : '#ff8079' %>',
        'marker-symbol': '<%= restaurant.place_type %>'
      }
    }
    geoJson.push(details)
    markers.addLayer(L.mapbox.markerLayer(details))

  <% end %>
  map.markerLayer.setGeoJSON(geoJson)
  map.fitBounds(markers.getBounds())

  BellyGuide.map = map
  BellyGuide.markers = markers
  BellyGuide.center = map.getCenter()
  BellyGuide.zoom = map.getZoom()
  BellyGuide.geoJson = geoJson

  var bakery = $('#filter-bakery')
  var bar = $('#filter-bar')
  var alcohol_shop = $('#filter-alcohol-shop')
  var cafe = $('#filter-cafe')
  var fast_food = $('#filter-fast-food')
  var grocery = $('#filter-grocery')
  var restaurant = $('#filter-restaurant')
  var slaughterhouse = $('#filter-slaughterhouse')

  var items = [bakery, bar, alcohol_shop, cafe,
               fast_food, grocery, restaurant, slaughterhouse]
  var symbols = ['bakery', 'bar', 'alcohol-shop', 'cafe',
              'fast-food', 'grocery', 'restaurant', 'slaughterhouse']

  var all = $('#filter-all')

  console.log(all)

  _(items).each(function (item, index) {
    item.on('click', function(e) {
      all.removeClass();
      _(items).each(function(item){ item.removeClass() })
      item.addClass('active')
      map.markerLayer.setFilter(function(f) {
        return f.properties['marker-symbol'] === symbols[index]
      });
      return false
    })
  })

  all.on('click', function() {
    _(items).each(function(item) { item.removeClass() })
    all.addClass('active')
    map.markerLayer.setFilter(function(f) {
      return true;
    });
    return false;
  });

  var compress = document.getElementById('compress')
  compress.onclick = function(e) {
    $item = $(e.currentTarget)
    $item.siblings().toggleClass('hide')
  }


</script>
