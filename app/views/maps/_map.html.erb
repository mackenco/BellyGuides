<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<script type="text/javascript"
 src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_API_KEY'] %>&sensor=false">
</script>

<script type="text/javascript">
  function initialize() {

    var mapOptions = {
      center: new google.maps.LatLng(<%=lat ? lat : 40.7577%>,
        <%=long ? long : -73.9857%>),
      zoom: <%=zoom%>,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };

    var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);
    BellyGuide.map = map
    BellyGuide.start = map.center

    <% restaurants.each do |r| %>
      createMarker(<%= r.latitude %>, <%= r.longitude %>,
        "<%= r.name %>", "<%= r.address %>", <%= r.completed %> )
    <% end %>

    function createMarker(lat, long, title, addy, completed) {
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, long),
        map: map,
        title: title,
        icon: {
          path: completed ? google.maps.SymbolPath.CIRCLE : google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
          scale: 5
        }
      });

      google.maps.event.addListener(marker, 'click', function() {
        var contentString =
          '<div id="info"><h1>'+title+'</h1><p>'+addy+'</p></div>'

        if (!this.getMap()._infoWindow){
          this.getMap()._infoWindow = new google.maps.InfoWindow();
        }
        this.getMap()._infoWindow.close();
        this.getMap()._infoWindow.setContent(contentString);
        this.getMap()._infoWindow.open(this.getMap(), this);
      });
    };
  }

  google.maps.event.addDomListener(window, 'load', initialize);

</script>